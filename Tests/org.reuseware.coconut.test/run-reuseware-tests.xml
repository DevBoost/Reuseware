<project basedir="." default="run-all-reuseware-tests" name="Run all tests for Reuseware (including Sokan)">
	
	<property environment="env"/>
	<property name="test_result_dir" value="/Users/jendrik/workspaces/reuseware/org.reuseware.coconut.test/test-results/reuseware"/>
	<property file="local.build.properties"/>	
	
	<!-- TODO enable run-application-tests,run-modelsoc-tests -->
	<target name="run-all-reuseware-tests" depends="clean-test-results,run-application-tests" />
	
	<target name="clean-test-results">
		<delete dir="${test_result_dir}" includes="*.txt" />
		<mkdir dir="${test_result_dir}" />
	</target>
		
	<target name="run-application-tests" depends="prepare-classpath">
		<junit haltonfailure="true" haltonerror="true" printsummary="true" fork="true" maxmemory="1024m"
				dir="../org.reuseware.coconut.test.applications">
			
			<jvmarg value="-ea" />
			<classpath>
				<path path="../temp_classpath.jar"/>
			</classpath>
			
			<formatter type="plain"/>
			
			<test name="org.reuseware.coconut.test.applications.ReusewareApplicationsCompositionTest" todir="${test_result_dir}"
				outfile="ReusewareApplications"/>
		</junit>
	</target>
		
	<target name="prepare-classpath">
		
		<path id="junit_classpath">
			<!-- ANTLR -->
			<pathelement path="../org.emftext.commons.antlr3_4_0/bin" />

			<!-- Sokan Plugins -->
			<pathelement path="../org.reuseware.sokan/bin" />
			<pathelement path="../org.reuseware.sokan.index/bin" />
			<pathelement path="../org.reuseware.sokan.index.solr/bin" />
			<pathelement path="../org.reuseware.sokan.resource/bin" />
			<!-- with Solr jars -->
			<fileset dir="../org.reuseware.sokan.index.solr/lib">
				<include name="*.jar"/>
			</fileset>
			
			<!-- CoCoNut Plugins -->
			<pathelement path="../org.reuseware.coconut.compositionprogram/bin" />
			<pathelement path="../org.reuseware.coconut.compositionprogram.resource.ucl/bin" />
			<pathelement path="../org.reuseware.coconut.fracol/bin" />
			<pathelement path="../org.reuseware.coconut.fracol.resource.fracol/bin" />
			<pathelement path="../org.reuseware.coconut.fragment/bin" />
			<pathelement path="../org.reuseware.coconut.id/bin" />
			<pathelement path="../org.reuseware.coconut.resource/bin" />
			<pathelement path="../org.reuseware.coconut.resource.sokan/bin" />
			<pathelement path="../org.reuseware.coconut.reuseextension/bin" />
			<pathelement path="../org.reuseware.coconut.reuseextension.evaluator.ocl/bin" />
			<pathelement path="../org.reuseware.coconut.reuseextension.resource.rex/bin" />
			<pathelement path="../org.reuseware.coconut.reuseextensionactivator/bin" />
			<pathelement path="../org.reuseware.coconut.reuseextensionactivator.resource.rexactivator/bin" />			
			
			<!-- Sokan Test Plugins -->
			<pathelement path="../org.reuseware.sokan.test/bin" />
			<pathelement path="../org.reuseware.sokan.test.all/bin" />
			<pathelement path="../org.reuseware.sokan.test.exampleindexer/bin" />
			<pathelement path="../org.reuseware.sokan.test.index/bin" />
			<pathelement path="../org.reuseware.sokan.test.indexer/bin" />
			<pathelement path="../org.reuseware.sokan.test.misc/bin" />

			<!-- CoCoNut Test Plugins -->
			<pathelement path="../org.reuseware.coconut.test/bin" />
			<pathelement path="../org.reuseware.coconut.test.sokan/bin" />
			<pathelement path="../org.reuseware.coconut.test.applications/bin" />

			<!-- Applications -->
			<pathelement path="../org.emftext.language.java/bin" />
			<pathelement path="../org.emftext.language.java.resource/bin" />
			<pathelement path="../org.emftext.language.java.resource.bcel/bin" />
			<pathelement path="../org.emftext.language.java.resource.java/bin" />
			<pathelement path="../org.emftext.language.modelquery/bin" />
			<pathelement path="../org.emftext.language.modelquery.resource/bin" />
			<pathelement path="../org.emftext.language.modelquery.resource.modelquery/bin" />
			<pathelement path="../org.reuseware.application.taipan/bin" />
			<pathelement path="../es.tid.cim/bin" />
			<pathelement path="../org.emftext.language.simpleweave/bin" />
			<pathelement path="../org.emftext.language.simpleweave.resource.simpleweave/bin" />
			<pathelement path="../org.reuseware.application.cim/bin" />
			<pathelement path="../org.emftext.language.usecaseinvariant/bin" />
			<pathelement path="../org.emftext.language.usecaseinvariant.resource/bin" />
			<pathelement path="../org.emftext.language.usecaseinvariant.resource.ucinv/bin" />
			<pathelement path="../org.emftext.language.valueflow/bin" />
			<pathelement path="../org.emftext.language.valueflow.resource/bin" />
			<pathelement path="../org.emftext.language.valueflow.resource.valueflow/bin" />
			<pathelement path="../org.emftext.language.secprop/bin" />
			<pathelement path="../org.emftext.language.secprop.resource/bin" />
			<pathelement path="../org.emftext.language.secprop.resource.text.secprop/bin" />
			<pathelement path="../org.oasisopen.names.tc.opendocument/bin" />
			<pathelement path="../org.emftext.language.java.reusejava/bin" />
			<pathelement path="../org.emftext.language.java.reusejava.resource/bin" />
			<pathelement path="../org.emftext.language.java.reusejava.resource.reusejava/bin" />
		
			<!-- Platform -->
			<fileset dir="/Applications/eclipse">
				<include name="plugins/**/org.junit_4*/junit.jar"/>
				<include name="plugins/**/org.hamcrest*.jar"/>
				<include name="plugins/**/org.eclipse.*.jar"/>
				<include name="plugins/**/*lpg*.jar"/>
			</fileset>
		</path>

		<manifestclasspath property="junit_classpath_prop" jarfile="../temp_classpath.jar" maxparentlevels="10">
			<classpath refid="junit_classpath" />
		</manifestclasspath>
		
		<jar destfile="../temp_classpath.jar">
			<manifest>
				<attribute name="Class-Path" value="${junit_classpath_prop}"/>
			</manifest>
		</jar>
	</target>
		
</project>